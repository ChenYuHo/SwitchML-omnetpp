#include "ModelStats.h"

// all in picoseconds

size_t n_layers[num_models] = { 4, 38, 2, 5, 8, 10, 5, 5, 6, 6 };

std::vector<int64_t> model_sizes[num_models] = { { 330688, 39891840, 16781312,
        4097000 },
        { 31260672, 8927232, 7346176, 9445376, 8400896, 7346176, 9445376,
                8400896, 7346176, 9445376, 8400896, 7346176, 9445376, 8400896,
                7346176, 9445376, 8400896, 7346176, 9445376, 8400896, 7346176,
                9445376, 8400896, 7346176, 9445376, 8400896, 7346176, 9445376,
                8400896, 7346176, 9445376, 8400896, 7346176, 9445376, 8400896,
                7346176, 9445376, 1053698 }, { 266368, 6358536 }, { 271200,
                6700160, 7604224, 6815616, 2443368 }, { 405824, 6755584,
                6703104, 6703104, 6703104, 7352832, 6822912, 3102696 }, {
                405824, 6758656, 6703104, 6703104, 6703104, 6703104, 6703104,
                8534528, 7875584, 3102696 }, { 405824, 6755584, 7417344,
                7875584, 3102696 }, { 370816, 8849664, 102764544, 16781312,
                4097000 }, { 555328, 7079936, 7079424, 102764544, 16781312,
                4097000 }, { 555328, 7670016, 7079424, 107484160, 16781312,
                4097000 }, { } };

std::vector<simtime_t> fp_times[num_models] = { };
std::vector<simtime_t> bp_times[num_models] = { };
std::vector<simtime_t> wu_times[num_models] = { };
simtime_t all_fps_and_last_bp_times[num_models] = { };
simtime_t all_fps_and_bps_times[num_models] = { };
std::vector<simtime_t> min_wait_times[num_models] = { };
std::vector<simtime_t> min_wait_times_wu[num_models] = { };
simtime_t min_wait_time_sums[num_models] = { };
simtime_t min_wait_time_sums_wu[num_models] = { };

std::vector<const char*> fp_times_raw_v100 =
        { "72335696500,54181105500,5190474500,1299764000",
                "242532500,1422774000,490109000,775182500,1043163500,461462000,806329000,1067211000,454707500,750172500,1060577000,454812000,931944000,1246423500,523168500,798766500,1114499000,510966000,834664000,1261876500,520059000,795514500,1132151000,508910000,948509500,1211126500,521539000,796167000,1108598000,512079000,828498000,1155310000,579621000,895095500,1284485500,601329500,981300500,569499500",
                "30185205500,46709435000",
                "43891055000,77070229000,25259025000,10587933000,1759603000",
                "16856297500,25547110500,15091611000,15044458500,15096274500,6723776500,3079460500,1109606000",
                "16709367500,33808184000,14763137500,14745100500,14786683000,14741305000,14751951500,10708416500,3866825000,1105839000",
                "32966564000,43797280000,14171111500,6571606500,1721004000",
                "34121382000,37234477000,2189397500,414009500,207461500",
                "76985513000,55822386500,10332968500,2263748500,425055000,209340000",
                "77003867500,69551843500,18017627000,9155561500,427270000,211285000" };

std::vector<const char*> bp_times_raw_v100 =
        { "49441525500,69647071500,2728194000,562800500",
                "258568000,123723840000,4653323000,1607525500,6030621000,4652562500,1607133000,4783708000,3405563000,3216755000,6032081500,1416404000,663680000,1859414000,1406547000,662003000,1853817000,1409691000,659715000,1854558000,1404187000,660082000,1851851500,1400815500,654958000,1848613500,1403915000,656173000,1840666000,1395569000,657860500,1855646500,1436026500,675964000,1911264000,1460666500,758437000,4584847500",
                "66113390500,108219707500",
                "105642588500,156230048500,54585410000,19512410500,3975473500",
                "41882641500,50849189500,27522799500,27503660000,27530805000,13337542000,5346164000,2920291500",
                "41810491500,70066534500,27528850500,27546766500,27535762500,27530083500,27534223000,21005601000,6874033000,3387058000",
                "81774634000,94682711000,31101970500,12403285000,3960688500",
                "66812213500,39245119500,48390500,81338000,620173000",
                "181729462000,82785525000,14069889000,58415500,121559500,451314500",
                "191537043500,128577605500,16727525500,7721257500,117450000,500068000" };

std::vector<const char*> wu_times_raw_v100 =
        { "2358282,284486280,119674927,29217511",
                "705927082,201594349,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,189708654,165891014,213295054,23794561",
                "67422397,1609456603",
                "101395593,2505039437,2843048674,2548205844,913520453",
                "39654335,660109278,654981293,654981293,654981293,718468252,666688108,303174147",
                "56135388,934887479,927203279,927203279,927203279,927203279,927203279,1180534025,1089385948,429178766",
                "27254167,453688826,498131041,528905341,208369625",
                "1159233,27665529,321259144,52461187,12807907",
                "1373414,17509797,17508531,254152904,41502828,10132526",
                "1566954,21642279,19975821,303285173,47351378,11560395" };

std::vector<const char*> fp_times_raw_a100 =
        { "96776024000,55509167500,8893365500,2537355500",
                "314800500,1537103500,479900500,741066500,978648500,437357500,693272500,941092000,414967000,654877000,910222000,407152500,654852500,880205000,387742500,587423000,780859500,331223000,513264000,771449500,314673500,482385000,663703500,292369000,471878000,646141000,286140000,463883000,635764500,284078000,459141000,630521000,278135500,448342000,624301500,281996000,458775000,257799500",
                "29124115500,42184422500",
                "45565248500,70894043500,19309937500,6590406000,1841389000",
                "34113195000,31443026000,16908857000,16937497500,16979608500,6718532000,3458445000,1317991500",
                "19155156000,24467338000,9644683000,9660367500,9693529500,9672163500,9671256000,6407392500,2459099500,756297500",
                "34767425000,32090937500,8683183000,4591439500,1358134500",
                "65419249500,65729609000,8709848500,1426330000,523210000",
                "144113040000,210255628500,15523542000,8375784500,1396934500,526164500",
                "70573949500,62814921500,16211693500,10446821500,834506000,308728500" };

std::vector<const char*> bp_times_raw_a100 =
        { "53405908500,56511237500,4644777500,425995500",
                "330100500,129120644500,4995911500,1760105000,6272845500,5016756000,1768595000,5556288000,3079849500,2910840500,8088381000,6282663000,2895831500,8044536000,5501170000,3576444000,4626791500,939872500,444203500,1267592000,1081523000,555596000,1635513500,1263104000,630834500,1772261500,1344703500,637765000,1829979000,1551522000,817585500,2434078000,1849624000,845577000,1989325000,1431473500,763702500,2611041000",
                "70621154000,107841519500",
                "115360455500,147017023500,40812652500,14784219500,3903534500",
                "82113557500,77238510500,40313374000,40210475500,39952811000,14746373000,7555437000,3018481000",
                "41759592000,56694533000,21700320500,21680111000,21602083000,21402987500,21805383000,15135321000,5821462000,2263516000",
                "81763874500,76482543000,19503053000,9431781500,2980309000",
                "145931993500,80744662000,129544000,143290500,394528500",
                "691534600500,666662286000,23865206000,124410000,140077500,499991000",
                "168968301500,128784119000,15464754500,7128568000,145204000,429821000" };

std::vector<const char*> wu_times_raw_a100 =
        { "3218914,388306794,163349133,39880159",
                "1222889767,349225399,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,328635602,287375891,369494733,41219731",
                "163730520,3908451480",
                "70876614,1751049612,1987321718,1781223396,638560659",
                "64667948,1076500544,1068137870,1068137870,1068137870,1171671857,1087229244,494413796",
                "67350238,1121661338,1112441971,1112441971,1112441971,1112441971,1112441971,1416383686,1307025848,514921036",
                "58466244,973263347,1068601774,1134619486,446999148",
                "2012437,48027571,557708344,91073023,22234625",
                "3673928,46839295,46835908,679867561,111021460,27104849",
                "4065696,56154116,51830244,786918570,122860206,29995167" };

std::vector<const char*> fp_times_raw_a100_match_v100_bs =
        { "46685743000,27035539000,4833722000,1306465000",
                "330905500,1780003500,501151500,752225000,973490000,434700500,685862000,931861500,416549000,659440000,913382000,412791500,665903000,906255500,400597500,624430000,835205500,356425500,521820500,774020000,307968000,480508500,649841500,290033500,469147500,638730500,286028500,464298500,635665500,285058500,463022000,629022500,279608000,451989500,618176000,281243500,459609000,257946000",
                "15605995500,26555617500",
                "23889576500,40683196500,12037993500,4284794000,1068552000",
                "12325342500,12241544500,5949076500,5866041500,5878092500,2432350500,1345146500,582989500",
                "11993105500,15962741500,5951722500,5925381500,5954765000,5927510000,5930991500,4027849000,1753183500,581078500",
                "20472903000,18619244000,5013706000,2587155000,807050000",
                "17300528000,16413875500,2686320500,526012500,167210000",
                "35380356000,24981548000,4538904000,2840212000,548901000,167983000",
                "35404450500,31167073000,8410777000,5907947500,552800000,171700000" };

std::vector<const char*> bp_times_raw_a100_match_v100_bs =
        { "26294594000,28547472500,2452105000,403852000",
                "251936000,67627116000,652609500,300758000,848897000,649284000,307378500,880553000,725602000,378824500,1135606000,900460000,425042000,1201292500,915013500,428449500,1206488000,940399500,448194000,1280650000,1017082000,527438500,1661086000,1284788000,629819000,1792840500,1363290500,644489500,1823978000,1507867500,784256500,2521142000,1932215000,821776000,2127707500,1486350000,772574500,2611184500",
                "34947830000,60995292000",
                "57265534500,77789599000,23924561500,11004249000,2742544500",
                "21489729000,21823229000,11726543500,12279622000,14193660500,5793828000,3474207500,1831033000",
                "21610415000,30789541500,11916651500,11845090500,11769696000,12091283500,13513398500,10323738000,4394130500,1988483000",
                "41568234500,40681321500,11280587500,5791822000,1973796000",
                "36315709500,20647053500,95546000,105052000,351218500",
                "85907324500,41359588500,7140273000,118681000,139077500,410036000",
                "87247521000,64377418500,8540515500,4054030500,138813000,423316500" };

std::vector<const char*> wu_times_raw_a100_match_v100_bs =
        { "3173701,382852590,161054711,39319998",
                "1228948264,350955548,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,330263743,288799621,371325301,41423944",
                "160853905,3839783095",
                "73487122,1815543791,2060518207,1846828928,662079951",
                "61703901,1027159285,1019179913,1019179913,1019179913,1117968433,1037396236,471752406",
                "68451690,1140005085,1130634943,1130634943,1130634943,1130634943,1130634943,1439547347,1328401062,523342099",
                "59333627,987702309,1084455141,1151452266,453630656",
                "2010402,47979014,557144491,90980947,22212145",
                "3644812,46468099,46464738,674479680,110141626,26890045",
                "4036439,55750027,51457270,781255849,121976095,29779320" };

simtime_t all_fps_and_last_bp(short m) {
    simtime_t sum = 0;
    for (auto fp : fp_times[m]) {
        sum += fp;
    }
    sum += bp_times[m][n_layers[m] - 1];
    return sum;
}

simtime_t all_fps_and_bps(short m) {
    simtime_t sum = 0;
    for (auto fp : fp_times[m]) {
        sum += fp;
    }
    for (auto bp : bp_times[m]) {
        sum += bp;
    }
    return sum;
}

std::vector<simtime_t> min_wait_time(short m, bool wu_as_busy, uint64_t gbps) {
    auto layers = n_layers[m];
    std::vector<simtime_t> remaining(layers);
    std::vector<simtime_t> min_idle_times(layers);
    for (unsigned i = 0; i < layers; ++i) {
        remaining[i] = fp_times[m][i] + bp_times[m][i];
        if (wu_as_busy) {
            remaining[i] += wu_times[m][i];
        }
    }
    unsigned check_from = 0;
    for (unsigned layer = 0; layer < layers; ++layer) {
        auto needed = wu_times[m][layer];
        needed += SimTime(model_sizes[m][layer] * 4 * 8 * 1000 / gbps,
                SIMTIME_PS);
        unsigned l = check_from;
        while (needed > 0 && l < layer) {
            if (remaining[l] > needed) {
                remaining[l] -= needed;
                needed = 0;
            } else {
                needed -= remaining[l];
                remaining[l] = 0;
                check_from = l;
            }
            l++;
        }
        min_idle_times[layer] = needed;
    }
    return min_idle_times;
}
